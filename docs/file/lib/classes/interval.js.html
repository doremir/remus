<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">lib/classes/interval.js | remus</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Generalized music representation"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="remus"><meta property="twitter:description" content="Generalized music representation"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#classes">classes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/audio-file.js~AudioFile.html">AudioFile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/duration.js~Duration.html">Duration</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/harmony.js~Harmony.html">Harmony</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/interval.js~Interval.html">Interval</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/item.js~Item.html">Item</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/mode.js~Mode.html">Mode</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/pitch.js~Pitch.html">Pitch</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/syllable.js~Syllable.html">Syllable</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#classes-event">classes/event</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/audio.js~Audio.html">Audio</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/chord-sequence.js~ChordSequence.html">ChordSequence</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/chord.js~Chord.html">Chord</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/event-container.js~EventContainer.html">EventContainer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/event.js~Event.html">Event</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/note-chord.js~NoteChord.html">NoteChord</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/note.js~Note.html">Note</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/rest.js~Rest.html">Rest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/song.js~Song.html">Song</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/tuplet.js~Tuplet.html">Tuplet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/vertical-container.js~VerticalContainer.html">VerticalContainer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/voice-container.js~VoiceContainer.html">VoiceContainer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/event/voice.js~Voice.html">Voice</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#classes-meta">classes/meta</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/meta/clef.js~Clef.html">Clef</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/meta/key.js~Key.html">Key</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/meta/meta.js~Meta.html">Meta</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/meta/tempo.js~Tempo.html">Tempo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/classes/meta/time.js~Time.html">Time</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#score">score</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/score.js~Score.html">Score</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#score-classes">score/classes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-bar.js~ScoreBar.html">ScoreBar</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-bracket.js~ScoreBracket.html">ScoreBracket</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-clef.js~ScoreClef.html">ScoreClef</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-detail.js~ScoreDetail.html">ScoreDetail</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-event.js~ScoreEvent.html">ScoreEvent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-item.js~ScoreItem.html">ScoreItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-key.js~ScoreKey.html">ScoreKey</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-meta.js~ScoreMeta.html">ScoreMeta</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-note-chord.js~ScoreNoteChord.html">ScoreNoteChord</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-note.js~ScoreNote.html">ScoreNote</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-rest.js~ScoreRest.html">ScoreRest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-syllable.js~ScoreSyllable.html">ScoreSyllable</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-tie.js~ScoreTie.html">ScoreTie</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-time.js~ScoreTime.html">ScoreTime</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/score-tuplet.js~ScoreTuplet.html">ScoreTuplet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/score/classes/staff-system.js~StaffSystem.html">StaffSystem</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/classes/interval.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">
import Item from &apos;./item.js&apos;;
import knowledge from &apos;../knowledge.js&apos;;
import vector from &apos;../vector.js&apos;;
import toCoord from &apos;interval-coords&apos;;
import misc from &apos;../misc.js&apos;;

// import chalk from &apos;chalk&apos;;

function negativeCoord(coord) {
  return [-coord[0], coord[1] ? -coord[1] : coord[1]]; // NOTE: works for both 0 and null
}

/**
 * Musical intervals.
 */
export default class Interval extends Item {
  /** @ignore */
  static getSlots() {
    return super.getSlots().concat([&apos;coord&apos;]);
  }

  /** @ignore */
  inspect() {
    // return chalk.red(&apos;&lt;&apos;) + chalk.red.bold(this.toString()) + chalk.red(&apos;&gt;&apos;);
  }

  /**
   * Display name (&quot;unison&quot;, &quot;second&quot;, &quot;third&quot;, etc)
   * @return {String}
   */
  name() {
    return knowledge.intervalsIndex[Math.abs(this.coord[0])];
  }

  /**
   * Number of semitones, positive for all intervals except P1
   * @return {Number?}
   */
  semitones() {
    return this.coord[1] === null ? null : Math.abs(this.coord[1]);
  }

  /**
   * The displayed number, always positive (all seconds return 2, thirds 3, decimas 10, etc)
   * @return {Number}
   */
  number() {
    return Math.abs(this.value());
  }

  /**
   * The interval number, positive or negative (2 means second up, -2 second down)
   * @return {Number}
   */
  value() {
    return this.coord[0] &lt; 0 ? this.coord[0] - 1 : this.coord[0] + 1;
  }

  // Internal: can the interval be perfect, or is it a minor/major interval?
  /** @ignore */
  kind() {
    return [0, 3, 4, 7].indexOf(Math.abs(this.coord[0]) % 7) &gt;= 0 ? &apos;perfect&apos; : &apos;minor&apos;;
  }

  /**
   * Returns the &quot;simple part&quot;, e.g. &quot;third&quot; for M10 and &quot;second&quot; for m9
   * The global Interval.octaveIsSimple determines if octave is treated as
   * a base interval or not (so P15 can be &quot;octave&quot; + 1 octave, or &quot;unison&quot; + 2 octaves)
   * @return {String}
   */
  base() {
    if (Interval.octaveIsSimple) {
      return knowledge.intervalsIndex[this.isCompound() ? (this.number() - 2) % 7 + 1 : (this.number() - 1)];
    } else {
      return knowledge.intervalsIndex[(this.number() - 1) % 7];
    }
  }

  /**
   * Returns number of octaves for compound intervals.
   * Note that if Interval.octaveIsSimple is set, a perfect octave would return 0!
   * @return {Number}
   */
  octaves() {
    if (Interval.octaveIsSimple) {
      return this.isCompound() ? Math.floor((this.number() - 2) / 7) : 0;
    } else {
      return Math.floor((this.number() - 1) / 7);
    }
  }

  /**
   * Returns &quot;up&quot; or &quot;down&quot;
   * @return {String}
   */
  direction(newDirection) {
    if (newDirection) {
      var dir = this.value() &gt;= 1 ? &apos;up&apos; : &apos;down&apos;;
      if (dir !== newDirection) {
        this.coord = negativeCoord(this.coord);
      }

      return this;
    } else {
      return this.value() &gt;= 1 ? &apos;up&apos; : &apos;down&apos;;
    }
  }

  simple(ignore) {
    // Get the (upwards) base interval (with quality)
    var octaves = this.octaves();
    var simple = [
      Math.abs(this.coord[0]) - octaves * 7,
      this.coord[1] !== null ? Math.abs(this.coord[1]) - octaves * 12 : null
    ];

    // Turn it around if necessary
    if (!ignore) {
      if (this.direction() === &apos;down&apos;) simple = negativeCoord(simple);
    }

    return new Interval({coord: simple});
  }

  /** @return {boolean} */
  isCompound() {
    return this.number() &gt; (Interval.octaveIsSimple ? 8 : 7);
  }

  /** @return {boolean} */
  isSimple() {
    return !this.isCompound();
  }

  /** @return {Interval} */
  invert() {
    var simple = this.simple();
    // Special: even when octaveIsSimple is false, we want unisons to
    // invert to octaves
    if (this.coord[0] % 7 === 0 &amp;&amp; this.coord[0]) {
      if (this.direction() === &apos;up&apos;) {
        return new Interval({coord: [0, simple.coord[1] ? -simple.coord[1] : simple.coord[1]]});
      } else {
        return new Interval({coord: [0, simple.coord[1]]});
      }
    }

    if (this.direction() === &apos;up&apos;) {
      return new Interval({coord: [7 - simple.coord[0], simple.coord[1] ? 12 - simple.coord[1] : simple.coord[1]]});
    } else {
      return new Interval({coord: [-7 - simple.coord[0], simple.coord[1] ? -12 - simple.coord[1] : simple.coord[1]]});
    }
  }

  /** @return {String} */
  quality(long) {
    if (this.coord[1] === null) return null;
    var quality = knowledge.alterations[this.kind()][this.qualityValue() + 2];
    return long ? knowledge.qualityLong[quality] : quality;
  }

  /** @return {Number} */
  qualityValue() {
    if (this.coord[1] === null) return null;
    if (this.direction() === &apos;down&apos;) {
      return (-this.coord[1] % 12) - knowledge.intervals[knowledge.intervalsIndex[(this.number() - 1) % 7]][1];
    } else {
      return (this.coord[1] % 12) - knowledge.intervals[knowledge.intervalsIndex[(this.number() - 1) % 7]][1];
    }
  }

  /**
   * @param {Interval} interval
   * @return {boolean}
   */
  equal(interval) {
    return this.coord[0] === interval.coord[0] &amp;&amp; this.coord[1] === interval.coord[1];
  }

  /**
   * @param {Interval} interval
   * @return {boolean}
   */
  greater(interval) {
    var semi = this.semitones();
    var isemi = interval.semitones();

    // If equal in absolute size, measure which interval is bigger
    // For example P4 is bigger than A3
    return (semi === isemi) ? (this.number() &gt; interval.number()) : (semi &gt; isemi);
  }

  /**
   * @param {Interval} interval
   * @return {boolean}
   */
  smaller(interval) {
    return !this.equal(interval) &amp;&amp; !this.greater(interval);
  }

  add(interval) {
    if (this.coord[1] === null || interval.coord[1] === null) {
      return new Interval({coord: [this.coord[0] + interval.coord[0]]});
    } else {
      return new Interval({coord: vector.add(this.coord, interval.coord)});
    }
  }

  /** @ignore */
  toString(ignore) {
    // If given true, return the positive value
    var number = ignore ? this.number() : this.value();

    return this.coord[1] === null ? &apos;&apos; + number : this.quality() + number;
  }
}

Interval.fromString = function(simple, parent) {
  var coord = toCoord(simple);
  if (!coord) {
    throw new Error(&apos;Invalid simple format interval&apos;);
  }

  return new Interval({coord: coord}, parent);
};

Interval.coerce = function(source, parent, copy) {
  if (source instanceof Interval) {
    if (copy) {
      return new Interval(source, parent);
    } else {
      return source;
    }
  }
  // TODO: What makes most sense: 3 meaning &quot;3&quot; =&gt; [2, null] (unspecified third), or 3 meaning [3, null] (unsp. fourth)??
  if (misc.isInteger(source)) { return new Interval({coord: [source, null]}); }
  if (typeof source === &apos;string&apos;) { return Interval.fromString(source, parent); }
  if (source instanceof Array &amp;&amp; source.length === 2) { return new Interval({coord: source}, parent); }
  throw new Error(&apos;Cannot coerce &apos; + source + &apos; to an interval!&apos;);
};

Interval.from = function(from, to) {   // ???
  return from.interval(to);
};

Interval.between = function(from, to) { // TODO: parameter for explicit key
  return new Interval({coord: vector.sub(to.toCoord(), from.toCoord())});
};

// Interval.invert = function(sInterval) {
//   return Interval.fromString(sInterval).invert().toString();
// };

Interval.octaveIsSimple = false;
Interval.itemType = &apos;Interval&apos;;

import ItemHandler from &apos;../item-handler.js&apos;;
ItemHandler.registerItem(Interval);
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
